---
import Section from "@/layouts/Section.astro";
import { BirdIcon } from "lucide-react";
import Product from "./Product.astro";
import data from "./product.json" assert { type: "json" };
import type { ProductType } from "./types";
import RandomImage from "../RandomImage.astro";
import VerticalText from "../VerticalText.astro";

const rawProducts = data.products as ProductType[];

const topProducts = rawProducts.sort((a, b) => parseInt(b.rating, 10) - parseInt(a.rating, 10)).slice(0, 3);

const imgSize = {
  width: 400,
  height: 500,
};
---

<Section
  extension="md"
  className=" max-w-[100vw] relative vertical center md:py-52 md:px-52 gap-28 [&>article]:w-full [&>article]:justify-center [&>article]:items-center [&>article]:gap-28"
>
  <VerticalText position="right" dark>Le meilleur de nos propositions</VerticalText>
  <style>
    .before-footer-fade {
      --color-start: #ffffff;
      background: linear-gradient(to bottom, var(--color-start) 0%, var(--color-start) 85%, #94c2e7 100%);
    }
  </style>
  <!-- OVERLAY -->
  <!-- <div class="absolute-align full before-footer-fade -z-10"></div> -->
  <!-- OVERLAY -->
  <div class="vertical gap-10 w-full">
    <BirdIcon className="h-10 w-10" />
    <h2 class="text-xl text-left">Ce que l'on vous conseille</h2>
  </div>
  {
    topProducts.map((product: ProductType, i: number) => {
      return (
        <article
          class={`${i % 2 !== 0 ? "vertical sm:horizontal-reverse" : "vertical sm:horizontal"}`}
          data-is={`product-${i}`}
        >
          <RandomImage width={imgSize.width} height={imgSize.height} />
          <Product {...product} />
        </article>
      );
    })
  }
</Section>
